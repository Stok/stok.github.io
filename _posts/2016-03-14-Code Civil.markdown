---
layout: post
title:  "An RNN that generates a fake 'code civil'"
date:   2016-03-14 00:26:57 +0100
categories: Projects
---
As I mentioned in my [last post], Karpathy implemented an [rnn that learns text]. 
Basically, what it does is: "(input) a single text file and the model learns to generate text like it."
This is a short account of an attempt at getting his code to run on my machine.

I'll skip the blow-by-blow account on how to get the code running. I basically followed Karpathy's [usage guide] 
to the letter, and everything worked.
I then treated the rnn code as a black box. Taught it a body of text, then extracted the rnn's creation.

I thought it'd be funny to teach my rnn the French "code civil", a compilation of laws in France.
Initially, I had no real reason. I just needed a large corpus (training set) that the rnn could learn.

The french [legifrance] website (the online compendium of all their laws) allows you to export things
as pdfs. So I downloaded the entire code civil. I've put the pdf I used on my [github page].
Using Wolfram Mathematica, converting a .pdf to a .txt (which is what's needed for the rnn) is trivial.

{% highlight mathematica%}
data = Import["path_to_code_civil"];
Export["desired_path_to_text_file/input.txt", data];
{% endhighlight %}

But I didn't want superflous newlines, headers, footnotes and chapter headings to confuse the rnn, 
so I cleaned up the corpus a little before exporting to text. 
Basically, each new line starts with an "Article". 
Everything else is removed.
Those notebooks are also on the same [github page], along with some output generated at two different 'temperatures' 
(a parameter used to quantify how audacious the rnn output should be. Errors increase, but so does 'creativity'. 
See Karpathy's [usage guide]). 

I trained the rnn and got it to generate a whole bunch of fake 'laws'.
As expected, the most frequent words in the original document also appear frequently in the fake. 
More interestingly, the fake output is often grammatically correct, although it almost never makes any sense.
('the cat ate the rooftop regardless of the colour of the tin foil'). 
It's sort of obvious: unlike humans, the rnn doesn't know anything about the world for which the laws were written.
A very strange read.

I then had an idea.
Let's play a little game: the article presented below is either a real article in the code civil, 
or some random gibberish generated by my rnn. Can you tell the difference? 
Don't worry: I'm not testing anyone's level of French, nor their understanding of French law.
I'm also not keeping tabs (your answers aren't recorded anywhere).
It's a simple script that picks out an article from a big list, shows it to you, 
then compares your answer to a lookup-table to see if you've got it right.
Have a go! 

<em><b><i>
<script src="https://code.jquery.com/jquery-1.10.2.js">
</script>
<script type='text/javascript' src='/ccQuiz/ccQuiz.js'>
</script>
<script>
selectNewEntry();
var sentence = getSentence();
document.write(sentence);
</script>
</i></b></em>

<button type="button" onclick="userRealClick();"><b>Real</b></button>
<button type="button" onclick="userFakeClick();"><b>Fake</b></button>
<button type="button" onclick="reloadPage();"><b>Load different article</b></button>

<script>
function reloadPage() {
location.reload();
}
function userRealClick() {
    var isTrue = checkIfTrue();
    if(isTrue == 1)
    {
        alert("Congratulations! It is a real article in the Code Civil.")
    }
    else
    {
        alert("Sorry, that one was made up by the rnn.")
    }
    reloadPage();
}
function userFakeClick() {
        var isTrue = checkIfTrue();
    if(isTrue == 1)
    {
        alert("Nope! That's actually a real article in the code civil.")
    }
    else
    {
        alert("Correct. That was a dummy.")
    }
    reloadPage();
}
</script> 

Now for a short rant, internet crackpot style.
What's striking isn't the difficulty of extracting meaning from computer-generated gibberish, 
but rather the difficulty of extracting it from actual law.
I wonder what would happen if no one could figure out what the rules were...

[last post]: /projects/2016/02/26/iChopin.html
[rnn that learns text]: https://github.com/karpathy/char-rnn
[usage guide]: https://github.com/karpathy/char-rnn
[legifrance]: http://www.legifrance.gouv.fr
[github page]: https://github.com/Stok/CCGenerator
